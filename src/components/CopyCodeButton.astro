---
export function initializeCopyButtons() {
    const snippets = document.querySelectorAll("pre");

    snippets.forEach((snippet) => {
        if (navigator.clipboard) {
            const button = document.createElement("button");

            button.innerText = "Copy code";
            button.className = "btn__copy-code";

            snippet.appendChild(button);

            button.addEventListener("click", async () => {
                await copyCode(snippet);
                button.innerText = "Copied!";

                setTimeout(() => {
                    button.innerText = "Copy code";
                }, 2000);
            });
        }
    });
}

async function copyCode(snippet: HTMLPreElement) {
    const code = snippet.querySelector("code");
    const text = code?.innerText;

    if (text) await navigator.clipboard.writeText(text);
}
---

<script is:inline>
    initializeCopyButtons();
</script>
